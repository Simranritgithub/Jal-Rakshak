// datasource db {
//   provider = "mongodb"
//   url      = env("DATABASE_URL")
// }

// generator client {
//   provider = "prisma-client-js"
// }

// // --- ENUMS ---
// enum Role {
//   ADMIN
//   HEALTH_OFFICIAL
//   ASHA_WORKER
//   VOLUNTEER
//   VILLAGER
// }

// enum UserStatus {
//   PENDING_APPROVAL
//   ACTIVE
//   INACTIVE
//   REJECTED // ADDED
// }

// // ADDED from your schema
// enum ReportStatus {
//   PENDING
//   IN_PROGRESS
//   COMPLETED
// }

// // UPDATED from your schema
// enum RiskLevel {
//   LOW
//   MEDIUM
//   HIGH
// }

// enum AlertTarget {
//   ALL
//   VILLAGER
//   ASHA_WORKER
//   VOLUNTEER
//   HEALTH_OFFICIAL
// }

// // Add this new model to your schema
// model UserNotification {
//   id        String   @id @default(auto()) @map("_id") @db.ObjectId
//   isRead    Boolean  @default(false)
//   createdAt DateTime @default(now())

//   // --- Relations ---
//   userId String @db.ObjectId
//   user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

//   alertId String @db.ObjectId
//   alert   Alert  @relation(fields: [alertId], references: [id], onDelete: Cascade)

//   // A user can only receive the same alert once
//   @@unique([userId, alertId])
// }

// // --- MODELS ---

// model User {
//   id            String             @id @default(auto()) @map("_id") @db.ObjectId
//   email         String             @unique
//   name          String
//   password      String?
//   role          Role
//   status        UserStatus         @default(PENDING_APPROVAL)
//   createdAt     DateTime           @default(now())
//   updatedAt     DateTime           @updatedAt
//   resetToken    String?
//   tokenExpiry   DateTime? // UPDATED from resetTokenExpiry
//   notifications UserNotification[]

//   regionId       String?         @db.ObjectId
//   region         Region?         @relation(fields: [regionId], references: [id])
//   ashaWorker     AshaWorker?
//   villager       Villager?
//   volunteer      Volunteer?
//   healthOfficial HealthOfficial?
//   admin          Admin?
//   village        Village?        @relation("VillageAshaWorkers", fields: [villageId], references: [id])
//   villageId      String?         @db.ObjectId
// }

// model Admin {
//   id     String @id @default(auto()) @map("_id") @db.ObjectId
//   userId String @unique @db.ObjectId
//   user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
// }

// model AshaWorker {
//   id              String   @id @default(auto()) @map("_id") @db.ObjectId
//   employeeId      String   @unique
//   userId          String   @unique @db.ObjectId
//   user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
//   contact         String
//   village         String
//   qualifications  String
//   experience      String?
//   applicationDate DateTime @default(now())
// }

// model Villager {
//   id          String    @id @default(auto()) @map("_id") @db.ObjectId
//   dateOfBirth DateTime?
//   gender      String?
//   contact     String
//   address     String?
//   familySize  Int?
//   userId      String    @unique @db.ObjectId
//   user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
// }

// model Volunteer {
//   id                      String   @id @default(auto()) @map("_id") @db.ObjectId
//   userId                  String   @unique @db.ObjectId
//   user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
//   contact                 String
//   availability            String?
//   skillsAndQualifications String[]
//   experience              String?
//   idCardUrl               String?
// }

// model HealthOfficial {
//   id         String  @id @default(auto()) @map("_id") @db.ObjectId
//   title      String
//   department String?
//   contact    String
//   userId     String  @unique @db.ObjectId
//   user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
// }

// // --- Geographic Models ---
// model State {
//   id        String   @id @default(auto()) @map("_id") @db.ObjectId
//   name      String   @unique
//   regions   Region[]
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
// }

// model Region {
//   id        String    @id @default(auto()) @map("_id") @db.ObjectId
//   name      String
//   language  String    @default("en")
//   stateId   String    @db.ObjectId
//   state     State     @relation(fields: [stateId], references: [id])
//   users     User[]
//   villages  Village[] // ADDED RELATION
//   alerts    Alert[] // ADDED RELATION
//   createdAt DateTime  @default(now())
//   updatedAt DateTime  @updatedAt
// }

// // --- INTEGRATED & REFINED MODELS ---

// // RE-INTRODUCED: Essential for linking geo-data to predictions/cases
// model Village {
//   id          String       @id @default(auto()) @map("_id") @db.ObjectId
//   name        String
//   latitude    Float
//   longitude   Float
//   regionId    String       @db.ObjectId
//   region      Region       @relation(fields: [regionId], references: [id])
//   cases       Case[]
//   reports     Report[]
//   predictions Prediction[]

//   // Relation to ASHA workers
//   ashaWorkers User[]    @relation("VillageAshaWorkers")
//   hotspots    Hotspot[]
//   createdAt   DateTime  @default(now())
//   updatedAt   DateTime  @updatedAt

//   @@unique([name, regionId])
// }

// // RE-INTRODUCED: For better data management and filtering
// model Disease {
//   id          String   @id @default(auto()) @map("_id") @db.ObjectId
//   name        String   @unique
//   description String?
//   symptoms    String[]
//   cases       Case[]
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
// }

// // UPDATED: From your schema, now with relations
// model Case {
//   id        String   @id @default(auto()) @map("_id") @db.ObjectId
//   villageId String   @db.ObjectId
//   village   Village  @relation(fields: [villageId], references: [id])
//   diseaseId String   @db.ObjectId
//   disease   Disease  @relation(fields: [diseaseId], references: [id])
//   date      DateTime @default(now())
//   count     Int
// }

// // UPDATED: From your schema, now with relations
// model Report {
//   id        String       @id @default(auto()) @map("_id") @db.ObjectId
//   reportId  String       @unique
//   villageId String       @db.ObjectId
//   village   Village      @relation(fields: [villageId], references: [id])
//   date      DateTime     @default(now())
//   status    ReportStatus @default(PENDING)
//   notes     String?
// }

// // UPDATED: From your schema, now with relations

// model Prediction {
//   id                  String    @id @default(auto()) @map("_id") @db.ObjectId
//   date                DateTime
//   anomalyScore        Float
//   isAnomaly           Boolean
//   riskLevel           RiskLevel
//   riskProbability     Float
//   predictionTimestamp DateTime  @default(now())
//   diseases            String[]
//   recommendation      String?
//   villageId           String    @db.ObjectId
//   village             Village   @relation(fields: [villageId], references: [id], onDelete: Cascade)
// }

// // RE-INTRODUCED: Essential for the "Send Alert" feature
// model Alert {
//   id      String      @id @default(auto()) @map("_id") @db.ObjectId
//   title   String
//   message String
//   target  AlertTarget
//   sentAt  DateTime    @default(now())
//   sentBy  String?

//   recipients UserNotification[]

//   // ‚úÖ Fix: single relation to Region (many alerts can belong to one region)
//   region   Region @relation(fields: [regionId], references: [id])
//   regionId String @db.ObjectId
// }

// model Hotspot {
//   id                  String   @id @default(auto()) @map("_id") @db.ObjectId
//   date                DateTime
//   riskLevel           String
//   riskProbability     Float
//   diseases            String[] // array of diseases
//   recommendation      String
//   anomalyScore        Float?
//   isAnomaly           Boolean?
//   predictionTimestamp DateTime

//   // relation with Village
//   villageId String  @map("village_id") @db.ObjectId
//   village   Village @relation(fields: [villageId], references: [id])

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
// }
// =================================================================
// DATASOURCE & GENERATOR
// =================================================================
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// =================================================================
// ENUMS
// =================================================================
enum Role {
  ADMIN
  HEALTH_OFFICIAL
  ASHA_WORKER
  VOLUNTEER
  VILLAGER
}

enum UserStatus {
  PENDING_APPROVAL
  ACTIVE
  INACTIVE
  REJECTED
}

enum ReportStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  ERROR
  UNKNOWN
}

enum AlertTarget {
  ALL
  VILLAGER
  ASHA_WORKER
  VOLUNTEER
  HEALTH_OFFICIAL
}

// =================================================================
// USER & AUTHENTICATION MODELS
// =================================================================
model User {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  email       String?
  password    String?
  role        Role
  status      UserStatus @default(PENDING_APPROVAL)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  resetToken  String?
  tokenExpiry DateTime?

  // Relations
  notifications UserNotification[]
  regionId      String?            @db.ObjectId
  region        Region?            @relation(fields: [regionId], references: [id])
  villageId     String?            @db.ObjectId
  village       Village?           @relation("VillageAshaWorkers", fields: [villageId], references: [id])

  admin          Admin?
  healthOfficial HealthOfficial?
  ashaWorker     AshaWorker?
  villager       Villager?
  volunteer      Volunteer?
}

model Admin {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model HealthOfficial {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  department String?
  contact    String?
  userId     String  @unique @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AshaWorker {
  id              String              @id @default(auto()) @map("_id") @db.ObjectId
  employeeId      String              @unique
  contact         String
  qualifications  String?
  experience      String?
  applicationDate DateTime            @default(now())
  userId          String              @unique @db.ObjectId
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  village         String?
  // Many-to-many with Village
  villages        AshaWorkerVillage[]
}

model Villager {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  dateOfBirth DateTime?
  gender      String?
  contact     String
  address     String?
  familySize  Int?
  userId      String    @unique @db.ObjectId
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Volunteer {
  id                      String   @id @default(auto()) @map("_id") @db.ObjectId
  contact                 String
  availability            String?
  skillsAndQualifications String[]
  experience              String?
  idCardUrl               String?
  userId                  String   @unique @db.ObjectId
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  village                 String?
}

// =================================================================
// NOTIFICATIONS & ALERTS
// =================================================================
model UserNotification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  alertId String @db.ObjectId
  alert   Alert  @relation(fields: [alertId], references: [id], onDelete: Cascade)

  @@unique([userId, alertId])
}

model Alert {
  id         String             @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  message    String
  target     AlertTarget
  sentAt     DateTime           @default(now())
  sentBy     String?
  regionId   String             @db.ObjectId
  region     Region             @relation(fields: [regionId], references: [id])
  recipients UserNotification[]
}

// =================================================================
// GEOGRAPHIC MODELS
// =================================================================
model State {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  regions   Region[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Region {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  language  String    @default("en")
  stateId   String    @db.ObjectId
  state     State     @relation(fields: [stateId], references: [id])
  users     User[]
  villages  Village[]
  alerts    Alert[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Village {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  latitude  Float?
  longitude Float?
  isHotspot Boolean @default(false)

  regionId String @db.ObjectId
  region   Region @relation(fields: [regionId], references: [id])

  cases       Case[]
  reports     Report[]
  predictions Prediction[]
  hotspots    Hotspot[]
  ashaWorkers AshaWorkerVillage[]

  // ü©∫ Health symptoms
  diarrheaCases Int? @default(0)
  vomitingCases Int? @default(0)
  feverCases    Int? @default(0)

  // üíß Water quality
  ph        Float? @default(7.0)
  turbidity Float? @default(1.0)
  tds       Int?   @default(200)

  // üå¶Ô∏è Weather
  rainfall    Float?  @default(0)
  temperature Float?  @default(25)
  humidity    Int?    @default(60)
  season      String? @default("monsoon")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User[]   @relation("VillageAshaWorkers")

  @@unique([name, regionId])
}

// Join table for AshaWorker ‚Üî Village
model AshaWorkerVillage {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  ashaWorkerId String @db.ObjectId
  villageId    String @db.ObjectId

  ashaWorker AshaWorker @relation(fields: [ashaWorkerId], references: [id])
  village    Village    @relation(fields: [villageId], references: [id])
}

// =================================================================
// HEALTH DATA MODELS
// =================================================================
model Disease {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String   @unique
  imageUrl    String?
  description String?
  symptoms    String[]
  cases       Case[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Case {
  id    String   @id @default(auto()) @map("_id") @db.ObjectId
  count Int
  date  DateTime @default(now())

  villageId String  @db.ObjectId
  village   Village @relation(fields: [villageId], references: [id], onDelete: Cascade)
  diseaseId String  @db.ObjectId
  disease   Disease @relation(fields: [diseaseId], references: [id], onDelete: Cascade)

  @@index([date])
}

model Report {
  id        String       @id @default(auto()) @map("_id") @db.ObjectId
  reportId  String       @unique
  date      DateTime     @default(now())
  status    ReportStatus @default(PENDING)
  notes     String?
  villageId String       @db.ObjectId
  village   Village      @relation(fields: [villageId], references: [id], onDelete: Cascade)
}

// =================================================================
// AI & HOTSPOTS
// =================================================================
model Prediction {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  date         DateTime
  anomalyScore Float?
  isAnomaly    Boolean?
  riskLevel    RiskLevel?

  riskProbability     Float
  predictionTimestamp DateTime @default(now())
  diseases            String[]
  recommendation      String?
  villageId           String   @db.ObjectId
  village             Village  @relation(fields: [villageId], references: [id], onDelete: Cascade)
}

model Hotspot {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  date                DateTime
  riskLevel           String
  riskProbability     Float
  diseases            String[]
  recommendation      String
  anomalyScore        Float?
  isAnomaly           Boolean?
  predictionTimestamp DateTime

  villageId String  @db.ObjectId
  village   Village @relation(fields: [villageId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SensorData {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  pondId      Int
  phValue     Float
  temperature Float
  waterLevel  String
  timestamp   DateTime @default(now())
}
